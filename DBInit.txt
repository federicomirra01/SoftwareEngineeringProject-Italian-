CREATE TABLE LIBRODIGITALE(
    CODICEISBN BIGINT(10) NOT NULL AUTO_INCREMENT PRIMARY KEY ,
    TITOLO VARCHAR(100) NOT NULL,
    AUTORI VARCHAR(100) NOT NULL,
    CASAEDITRICE VARCHAR(100) NOT NULL,
    GENERE VARCHAR(100) NOT NULL,
    PREZZO DOUBLE NOT NULL
);

CREATE TABLE LIBROCARTACEO(
    CODICEISBN BIGINT(10) PRIMARY KEY NOT NULL,
    TITOLO VARCHAR(100) NOT NULL,
    AUTORI VARCHAR(100) NOT NULL,
    CASAEDITRICE VARCHAR(100) NOT NULL,
    GENERE VARCHAR(100) NOT NULL,
    PREZZO DOUBLE NOT NULL,
    QUANTITÀDISPONIBILE INT NOT NULL
);

CREATE TABLE DIPENDENTE(
    IDDIPENDENTE BIGINT(10) NOT NULL AUTO_INCREMENT PRIMARY KEY,
    NOMEUTENTE VARCHAR(255) NOT NULL UNIQUE,
    PASSWORD VARCHAR(255) NOT NULL
);

CREATE TABLE CLIENTEREGISTRATO(
    IDCLIENTEREGISTRATO BIGINT(10) NOT NULL AUTO_INCREMENT PRIMARY KEY,
    NOMEUTENTE VARCHAR(255) NOT NULL UNIQUE,
    PASSWORD VARCHAR(255) NOT NULL,
    NOME VARCHAR(255) NOT NULL,
    COGNOME VARCHAR(255) NOT NULL,
    INDIRIZZO VARCHAR(255) NOT NULL,
    CAP INT NOT NULL,
    TELEFONO BIGINT,
    CITTÀ VARCHAR(255) NOT NULL,
    EMAIL VARCHAR(255) NOT NULL,
    IDCARRELLO BIGINT(10) NOT NULL
);

CREATE TABLE CARRELLO(
    IDCARRELLO BIGINT(10) NOT NULL AUTO_INCREMENT PRIMARY KEY,
    PREZZO DOUBLE DEFAULT 0
);

ALTER TABLE CLIENTEREGISTRATO ADD CONSTRAINT fk_idcarrello FOREIGN KEY(IDCARRELLO) REFERENCES CARRELLO(IDCARRELLO) ON UPDATE CASCADE ON DELETE CASCADE;

CREATE TABLE INSERIMENTOCARTACEO(
    IDCARRELLO BIGINT(10),
    CODICEISBN BIGINT(10),
    QUANTITÀRICHIESTA INT NOT NULL,
    PRIMARY KEY(IDCARRELLO, CODICEISBN)
);

ALTER TABLE INSERIMENTOCARTACEO ADD CONSTRAINT fk_carrello_IC FOREIGN KEY (IDCARRELLO) REFERENCES CARRELLO(IDCARRELLO) ON UPDATE CASCADE ON DELETE CASCADE;
ALTER TABLE INSERIMENTOCARTACEO ADD CONSTRAINT fk_codiceISBN_IC FOREIGN KEY (CODICEISBN) REFERENCES LIBROCARTACEO(CODICEISBN) ON UPDATE CASCADE ON DELETE CASCADE;

CREATE TABLE INSERIMENTODIGITALE(
    IDCARRELLO BIGINT(10),
    CODICEISBN BIGINT(10),
    PRIMARY KEY(IDCARRELLO, CODICEISBN)
);

ALTER TABLE INSERIMENTODIGITALE ADD CONSTRAINT fk_carrello_ID FOREIGN KEY (IDCARRELLO) REFERENCES CARRELLO(IDCARRELLO) ON UPDATE CASCADE ON DELETE CASCADE;
ALTER TABLE INSERIMENTODIGITALE ADD CONSTRAINT fk_codiceISBN_ID FOREIGN KEY (CODICEISBN) REFERENCES LIBRODIGITALE(CODICEISBN) ON UPDATE CASCADE ON DELETE CASCADE;

CREATE TABLE ORDINECARTACEO(
    IDORDINECARTACEO BIGINT(10) NOT NULL AUTO_INCREMENT PRIMARY KEY,
    DATACONSEGNA DATE,
    STATO VARCHAR(20),
    PREZZO DOUBLE,
    IDCLIENTEREGISTRATO BIGINT(10)
);

ALTER TABLE ORDINECARTACEO ADD CONSTRAINT fk_clienteregistratoOC FOREIGN KEY(IDCLIENTEREGISTRATO) REFERENCES CLIENTEREGISTRATO(IDCLIENTEREGISTRATO) ON UPDATE CASCADE ON DELETE CASCADE;

CREATE TABLE ORDINEDIGITALE(
    IDORDINEDIGITALE BIGINT(10) NOT NULL AUTO_INCREMENT PRIMARY KEY,
    DATASCARICAMENTO DATE,
    STATO VARCHAR(20),
    PREZZO DOUBLE,
    IDCLIENTEREGISTRATO BIGINT(10)
);

ALTER TABLE ORDINEDIGITALE ADD CONSTRAINT fk_clienteregistratoOD FOREIGN KEY(IDCLIENTEREGISTRATO) REFERENCES CLIENTEREGISTRATO(IDCLIENTEREGISTRATO) ON UPDATE CASCADE ON DELETE CASCADE;

CREATE TABLE ACQUISTODIGITALE(
    IDORDINEDIGITALE BIGINT(10),
    CODICEISBN BIGINT(10),
    CODICESCARICAMENTO VARCHAR(10),
    PRIMARY KEY(IDORDINEDIGITALE, CODICEISBN)
);

ALTER TABLE ACQUISTODIGITALE ADD CONSTRAINT fk_ordine_AD FOREIGN KEY (IDORDINEDIGITALE) REFERENCES ORDINEDIGITALE(IDORDINEDIGITALE) ON UPDATE CASCADE ON DELETE CASCADE;
ALTER TABLE ACQUISTODIGITALE ADD CONSTRAINT fk_codiceISBN_AD FOREIGN KEY (CODICEISBN) REFERENCES LIBRODIGITALE(CODICEISBN) ON UPDATE CASCADE ON DELETE CASCADE;

CREATE TABLE ACQUISTOCARTACEO(
    IDORDINECARTACEO BIGINT(10),
    CODICEISBN BIGINT(10),
    PRIMARY KEY(IDORDINECARTACEO, CODICEISBN)
);

ALTER TABLE ACQUISTOCARTACEO ADD CONSTRAINT fk_ordine_AC FOREIGN KEY (IDORDINECARTACEO) REFERENCES ORDINECARTACEO(IDORDINECARTACEO) ON UPDATE CASCADE ON DELETE CASCADE;
ALTER TABLE ACQUISTOCARTACEO ADD CONSTRAINT fk_codiceISBN_AC FOREIGN KEY (CODICEISBN) REFERENCES LIBROCARTACEO(CODICEISBN) ON UPDATE CASCADE ON DELETE CASCADE;

INSERT INTO CARRELLO VALUES (1,0);
INSERT INTO CARRELLO VALUES(2,0);
INSERT INTO CLIENTEREGISTRATO VALUES (1,'tommaso', 'tommaso', 'test', 'test', 'test', 1111, 8888888, 'test', 'tommasotest@gmail.com', 1);
INSERT INTO CLIENTEREGISTRATO VALUE (2, 'CarmineTest', 1, 'test', 'test', 'test', 9999, 9999999, 'test', 'carminetest@gmail.com', 2);
INSERT INTO DIPENDENTE VALUE (1, 'dipendente', 'dipendente');
INSERT INTO LIBROCARTACEO VALUES (1111111111, 'test', 'test', 'test', 'test', 10, 20)
